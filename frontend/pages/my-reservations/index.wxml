<view class="container">
  <view class="empty-tip" wx:if="{{reservations.length === 0}}">
    暂无预约记录
  </view>

  <view class="reservation-list">
    <view wx:for="{{reservations}}" wx:key="_id" class="card reservation-item">
      <view class="item-header">
        <text class="campus-name">{{item.campus_name || (item.campus_id == 1 ? '学院路校区' : '沙河校区')}}</text>
        <text class="status {{item.status}}">{{item.status === 'active' ? '已预约' : '已取消'}}</text>
      </view>
      <view class="item-body">
        <view class="info-row">
          <text class="label">日期：</text>
          <text>{{item.date}}</text>
        </view>
        <view class="info-row">
          <text class="label">时间：</text>
          <text>{{item.start_hour}}:00 - {{item.end_hour}}:00</text>
        </view>
        <view class="info-row" wx:if="{{item.key_picked_up}}">
          <text class="label">钥匙：</text>
          <text class="success">已领取</text>
        </view>
        <view class="info-row" wx:if="{{item.key_returned}}">
          <text class="label">归还：</text>
          <text class="success">已归还</text>
        </view>
      </view>
      <view class="item-footer" wx:if="{{item.status === 'active'}}">
        <button class="btn-mini btn-cancel" bindtap="cancelReservation" data-id="{{item._id}}">取消预约</button>
        
        <!-- Key actions (Optional, maybe only for key managers or self-service if trusted) -->
        <!-- Assuming self-service for now based on "remove auth" context, or maybe just display status -->
        <button class="btn-mini" wx:if="{{!item.key_picked_up}}" bindtap="pickupKey" data-id="{{item._id}}">登记取钥</button>
        <button class="btn-mini" wx:if="{{item.key_picked_up && !item.key_returned}}" bindtap="returnKey" data-id="{{item._id}}">登记还钥</button>
      </view>
    </view>
  </view>
</view>
